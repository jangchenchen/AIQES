# AIè¯­ä¹‰è¯„åˆ†åŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

**AIè¯­ä¹‰è¯„åˆ†**åŠŸèƒ½å…è®¸ç³»ç»Ÿä½¿ç”¨AIæ¨¡å‹å¯¹**å¡«ç©ºé¢˜**å’Œ**é—®ç­”é¢˜**è¿›è¡Œæ™ºèƒ½è¯„åˆ†ï¼Œè€Œä¸ä»…ä»…ä¾èµ–å…³é”®è¯åŒ¹é…ã€‚

### âœ… ä¸»è¦ä¼˜åŠ¿

1. **æ›´æ™ºèƒ½çš„è¯„åˆ†**: AIç†è§£è¯­ä¹‰ï¼Œè€Œéç®€å•çš„å…³é”®è¯åŒ¹é…
2. **åŒä¹‰è¯è¯†åˆ«**: "å·¥å…·" â‰ˆ "å™¨å…·"ã€"é˜²æŠ¤" â‰ˆ "ä¿æŠ¤"
3. **éƒ¨åˆ†æ­£ç¡®è¯„åˆ†**: å¯ä»¥ç»™å‡º0-100çš„å¾—åˆ†ï¼Œè€Œéä»…ä»…å¯¹/é”™
4. **è¯¦ç»†åé¦ˆ**: AIä¼šæä¾›å…·ä½“çš„è¯„ä»·è¯´æ˜
5. **ç”¨æˆ·å¯æ§**: å®Œå…¨ç”±ç”¨æˆ·å†³å®šæ˜¯å¦å¯ç”¨

---

## ğŸ¯ å·¥ä½œåŸç†

### è¯„åˆ†æµç¨‹

```
ç”¨æˆ·æäº¤ç­”æ¡ˆ
    â†“
æ£€æŸ¥: AIè¯„åˆ†æ˜¯å¦å¯ç”¨ï¼Ÿ
    â†“ (æ˜¯)
AIè¯­ä¹‰è¯„åˆ†
    â†“
æˆåŠŸï¼Ÿ â†’ è¿”å›AIè¯„åˆ†ç»“æœ
    â†“ (å¤±è´¥)
é™çº§åˆ°å…³é”®è¯åŒ¹é…
    â†“
è¿”å›å…³é”®è¯åŒ¹é…ç»“æœ
```

### é™çº§ä¿æŠ¤

- âœ… AIæœªé…ç½® â†’ ä½¿ç”¨å…³é”®è¯åŒ¹é…
- âœ… AIè¯„åˆ†å¤±è´¥ â†’ è‡ªåŠ¨é™çº§åˆ°å…³é”®è¯åŒ¹é…
- âœ… AIè¿”å›é”™è¯¯ â†’ è‡ªåŠ¨é™çº§åˆ°å…³é”®è¯åŒ¹é…
- âœ… ç¡®ä¿ç³»ç»Ÿå§‹ç»ˆå¯ç”¨

---

## ğŸ”§ å¯ç”¨æ–¹æ³•

### æ–¹æ³•1: é€šè¿‡Webç•Œé¢

1. è®¿é—® `http://localhost:5001/web/ai-config/index.html`
2. å‹¾é€‰"å¯ç”¨ AI è¯­ä¹‰è¯„åˆ†"å¤é€‰æ¡†
3. ç‚¹å‡»"ä¿å­˜é…ç½®"

### æ–¹æ³•2: ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `AI_cf/cf.json`:

```json
{
  "key": "sk-...",
  "url": "https://api.example.com/v1/chat/completions",
  "model": "gpt-4o-mini",
  "timeout": 60.0,
  "enable_ai_grading": true  â† è®¾ç½®ä¸ºtrue
}
```

---

## ğŸ“Š è¯„åˆ†ç¤ºä¾‹

### ç¤ºä¾‹1: å®Œå…¨æ­£ç¡®

**é—®é¢˜**: åœ¨è¿›è¡Œé©±åŠ¨ä¸»æœºä½ç½®æ£€æŸ¥å‰ï¼Œéœ€è¦å®Œæˆå“ªäº›å‡†å¤‡ï¼Ÿ

**æ ‡å‡†ç­”æ¡ˆ**: éœ€è¦å‡†å¤‡å·¥å…·å’Œç‰©æ–™ï¼Œä¸¥ç¦é…’åã€å¸¦ç—…æˆ–ç–²åŠ³ä½œä¸šï¼Œå®Œæˆé£é™©æ‰«æå’Œä½©æˆ´ä¸ªäººé˜²æŠ¤ç”¨å“ï¼Œè®¾ç½®è­¦å‘Šé˜²æŠ¤æ ã€‚

**ç”¨æˆ·ç­”æ¡ˆ**: è¦å‡†å¤‡å¥½å·¥å…·å’Œé˜²æŠ¤ç”¨å“ï¼Œä¸èƒ½é…’åä½œä¸šï¼Œè¿˜è¦åšé£é™©æ‰«æã€‚

**AIè¯„åˆ†ç»“æœ**:
```
âœ“ AIè¯„åˆ†ï¼š95åˆ† - ç­”æ¡ˆåŒ…å«ä¸»è¦è¦ç‚¹ï¼Œè¡¨è¿°æ¸…æ™°
åŒ¹é…è¦ç‚¹ï¼šå·¥å…·ã€é˜²æŠ¤ç”¨å“ã€é£é™©æ‰«æ
```

### ç¤ºä¾‹2: éƒ¨åˆ†æ­£ç¡®

**ç”¨æˆ·ç­”æ¡ˆ**: å‡†å¤‡å·¥å…·å°±è¡Œäº†ã€‚

**AIè¯„åˆ†ç»“æœ**:
```
âœ— AIè¯„åˆ†ï¼š40åˆ† - ç­”æ¡ˆè¿‡äºç®€å•ï¼Œé—æ¼é‡è¦å®‰å…¨è¦æ±‚
åŒ¹é…è¦ç‚¹ï¼šå·¥å…·
```

### ç¤ºä¾‹3: é”™è¯¯ç­”æ¡ˆ

**ç”¨æˆ·ç­”æ¡ˆ**: ä¸éœ€è¦ä»»ä½•å‡†å¤‡ã€‚

**AIè¯„åˆ†ç»“æœ**:
```
âœ— AIè¯„åˆ†ï¼š0åˆ† - ç­”æ¡ˆé”™è¯¯ï¼Œä¸æ ‡å‡†ç­”æ¡ˆå®Œå…¨ä¸ç¬¦
```

---

## âš™ï¸ æŠ€æœ¯å®ç°

### ä»£ç ç»“æ„

#### 1. AIå®¢æˆ·ç«¯ (`src/ai_client.py`)

```python
def evaluate_answer(
    self,
    question_prompt: str,
    standard_answer: str,
    user_answer: str,
    question_type: str = "é—®ç­”é¢˜",
) -> Dict[str, Any]:
    """ä½¿ç”¨AIè¯„ä¼°ç”¨æˆ·ç­”æ¡ˆçš„æ­£ç¡®æ€§"""
    # æ„å»ºè¯„åˆ†æç¤ºè¯
    # è°ƒç”¨AIæ¨¡å‹
    # è§£æç»“æœ
    return {
        "is_correct": bool,
        "score": int,  # 0-100
        "explanation": str,
        "matched_points": List[str]
    }
```

#### 2. WebæœåŠ¡å™¨ (`web_server.py`)

```python
def _try_ai_grading(question, user_answer, question_type_name):
    """å°è¯•ä½¿ç”¨AIè¿›è¡Œè¯­ä¹‰è¯„åˆ†"""
    try:
        ai_config = load_ai_config()
        if not ai_config.enable_ai_grading:
            return None  # æœªå¯ç”¨ï¼Œé™çº§

        ai_client = AIClient(ai_config)
        result = ai_client.evaluate_answer(...)

        if result.get("error"):
            return None  # å¤±è´¥ï¼Œé™çº§

        return (is_correct, feedback)
    except Exception:
        return None  # å¼‚å¸¸ï¼Œé™çº§
```

#### 3. è¯„åˆ†å‡½æ•°

**å¡«ç©ºé¢˜** (`_grade_cloze`):
```python
def _grade_cloze(question, user_answer):
    # 1. å°è¯•AIè¯„åˆ†
    ai_result = _try_ai_grading(question, user_answer, "å¡«ç©ºé¢˜")
    if ai_result:
        return ai_result

    # 2. é™çº§ï¼šå…³é”®è¯åŒ¹é…
    for keyword in question.keywords:
        if keyword in user_answer:
            return True, "âœ“ å…³é”®è¯åŒ¹é…"
    return False, "âœ— æœªåŒ…å«å…³é”®è¯"
```

**é—®ç­”é¢˜** (`_grade_qa`):
```python
def _grade_qa(question, user_answer):
    # 1. å°è¯•AIè¯„åˆ†
    ai_result = _try_ai_grading(question, user_answer, "é—®ç­”é¢˜")
    if ai_result:
        return ai_result

    # 2. é™çº§ï¼šå…³é”®è¯åŒ¹é…
    matched = [kw for kw in question.keywords if kw in user_answer]
    if matched:
        return True, f"âœ“ åŒ…å«è¦ç‚¹ï¼š{matched}"
    return False, "âœ— ç¼ºå°‘å…³é”®è¦ç‚¹"
```

---

## ğŸ”’ å®‰å…¨æ€§è¯´æ˜

### APIè°ƒç”¨æ¶ˆè€—

- âœ… åªæœ‰å¯ç”¨AIè¯„åˆ†æ—¶æ‰è°ƒç”¨API
- âœ… å•é€‰é¢˜/å¤šé€‰é¢˜**ä¸ä½¿ç”¨**AIè¯„åˆ†ï¼ˆç²¾ç¡®åŒ¹é…å³å¯ï¼‰
- âœ… å¡«ç©ºé¢˜/é—®ç­”é¢˜æ‰ä½¿ç”¨AIè¯„åˆ†
- âš ï¸ æ¯æ¬¡æäº¤ç­”æ¡ˆ = 1æ¬¡APIè°ƒç”¨

### å»ºè®®

1. **æˆæœ¬æ§åˆ¶**: å¦‚æœAPIè°ƒç”¨æœ‰é™é¢ï¼Œå¯ä»¥ä»…åœ¨é‡è¦åœºåˆå¯ç”¨
2. **æµ‹è¯•åœºæ™¯**: ç»ƒä¹ æ—¶å¯ä»¥å…³é—­ï¼Œæ­£å¼è€ƒè¯•æ—¶å¼€å¯
3. **æ··åˆæ¨¡å¼**: ç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨AIå¤±è´¥æ—¶é™çº§ï¼Œç¡®ä¿å¯ç”¨æ€§

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| è¯„åˆ†æ–¹å¼ | å‡†ç¡®åº¦ | é€Ÿåº¦ | æˆæœ¬ | çµæ´»æ€§ |
|----------|--------|------|------|--------|
| å…³é”®è¯åŒ¹é… | â­â­ | â­â­â­â­â­ | å…è´¹ | â­â­ |
| AIè¯­ä¹‰è¯„åˆ† | â­â­â­â­â­ | â­â­ | ä»˜è´¹ | â­â­â­â­â­ |

### æ¨èç­–ç•¥

- **ç»ƒä¹ æ¨¡å¼**: å…³é—­AIè¯„åˆ†ï¼ˆèŠ‚çœæˆæœ¬ï¼‰
- **æ­£å¼è€ƒè¯•**: å¼€å¯AIè¯„åˆ†ï¼ˆæé«˜å‡†ç¡®åº¦ï¼‰
- **å¤§è§„æ¨¡ä½¿ç”¨**: æ ¹æ®é¢„ç®—å†³å®š

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: AIè¯„åˆ†å§‹ç»ˆä¸å·¥ä½œ

**æ£€æŸ¥æ¸…å•**:
1. âœ… AIé…ç½®ä¸­ `enable_ai_grading` æ˜¯å¦ä¸º `true`
2. âœ… APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
3. âœ… ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. âœ… æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯

**å‘½ä»¤**:
```bash
# æ£€æŸ¥é…ç½®
cat AI_cf/cf.json | grep enable_ai_grading

# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
# åº”è¯¥çœ‹åˆ° "âœ… AIè¯„åˆ†æˆåŠŸ" æˆ– "âš ï¸ AIè¯„åˆ†å¤±è´¥"
```

### é—®é¢˜2: AIè¯„åˆ†å¤ªæ…¢

**è§£å†³æ–¹æ¡ˆ**:
- å¢åŠ  `timeout` å€¼ï¼ˆå»ºè®®60-120ç§’ï¼‰
- æ£€æŸ¥APIæœåŠ¡å™¨å“åº”é€Ÿåº¦
- è€ƒè™‘ä½¿ç”¨æ›´å¿«çš„æ¨¡å‹

### é—®é¢˜3: è¯„åˆ†ç»“æœä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**:
- AIæ¨¡å‹é€‰æ‹©ï¼šæ¨èä½¿ç”¨ GPT-4 æˆ–ç±»ä¼¼é«˜çº§æ¨¡å‹
- æ£€æŸ¥æ ‡å‡†ç­”æ¡ˆæ˜¯å¦æ¸…æ™°
- æŸ¥çœ‹AIè¿”å›çš„ `explanation` äº†è§£åˆ¤åˆ†ä¾æ®

---

## ğŸ“ APIæ¥å£

### è·å–AIé…ç½®

```bash
GET /api/ai-config
```

**å“åº”**:
```json
{
  "key": "sk-...",
  "url": "https://...",
  "model": "gpt-4o-mini",
  "timeout": 60.0,
  "enable_ai_grading": true
}
```

### æ›´æ–°AIé…ç½®

```bash
PUT /api/ai-config
Content-Type: application/json

{
  "key": "sk-...",
  "url": "https://...",
  "model": "gpt-4o-mini",
  "timeout": 60.0,
  "enable_ai_grading": true
}
```

---

## âœ¨ æœ€ä½³å®è·µ

### 1. é¢˜ç›®è®¾è®¡

ä¸ºäº†è®©AIè¯„åˆ†æ›´å‡†ç¡®ï¼š
- âœ… æ ‡å‡†ç­”æ¡ˆæ¸…æ™°æ˜ç¡®
- âœ… é¿å…æ­§ä¹‰è¡¨è¿°
- âœ… åŒ…å«æ˜ç¡®çš„è¯„åˆ†è¦ç‚¹

### 2. ç”¨æˆ·æŒ‡å¯¼

æç¤ºç”¨æˆ·ï¼š
- âœ… å¡«ç©ºé¢˜ï¼šåŒ…å«å…³é”®è¯å³å¯
- âœ… é—®ç­”é¢˜ï¼šåŒ…å«ä¸»è¦è¦ç‚¹ï¼Œä¸éœ€è¦é€å­—ç›¸åŒ

### 3. æˆæœ¬ä¼˜åŒ–

- âœ… æµ‹è¯•ç¯å¢ƒï¼šå…³é—­AIè¯„åˆ†
- âœ… ç”Ÿäº§ç¯å¢ƒï¼šæ ¹æ®éœ€æ±‚å¼€å¯
- âœ… æ··åˆæ¨¡å¼ï¼šå®¢è§‚é¢˜ç”¨å…³é”®è¯ï¼Œä¸»è§‚é¢˜ç”¨AI

---

## ğŸ“ æ€»ç»“

**AIè¯­ä¹‰è¯„åˆ†**æ˜¯ä¸€ä¸ªå¼ºå¤§ä½†å¯é€‰çš„åŠŸèƒ½ï¼š

- âœ… **å¼€å¯æ—¶**: æ™ºèƒ½ã€çµæ´»ã€å‡†ç¡®
- âœ… **å…³é—­æ—¶**: å¿«é€Ÿã€å…è´¹ã€å¯é 
- âœ… **å¤±è´¥æ—¶**: è‡ªåŠ¨é™çº§ï¼Œä¿è¯å¯ç”¨

ç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚ã€é¢„ç®—å’Œåœºæ™¯çµæ´»é€‰æ‹©ï¼

---

**å®ç°æ—¥æœŸ**: 2025-11-04
**ç‰ˆæœ¬**: 1.0
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•
